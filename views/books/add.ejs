<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AddBooks</title>

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css"
        integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@9"></script>

</head>

<body class="container" style="margin-top: 50px;">

    <div class="card">

        <div class="card-header">
            Add book
        </div>
        <div class="card-body">
            <form id="form-message" action="#" method="post" encType="multipart/form-data">
                <div class="form-group">
                    <label>Name:</label>
                    <input type="text" class="form-control" id="name" name="name" value="<%= name %>"
                        autocomplete="off">
                </div>
                <div class="form-group">
                    <label>Details:</label>
                    <input type="text" class="form-control" id="details" name="details" value="<%= details %>"
                        autocomplete="off">
                </div>
                <div class="form-group">
                    <label>Price:</label>
                    <input type="text" class="form-control" id="price" name="price" value="<%= price %>"
                        autocomplete="off">
                </div>
                <div class="form-group">
                    <label>Quantity:</label>
                    <input type="number" class="form-control" id="quantity" name="quantity" value="<%= quantity %>"
                        autocomplete="off">
                </div>
                <div class="form-group">
                    <label>Image:</label>
                    <input type="file" accept="image/*" class="form-control" id="upload_img" name="upload_img"
                        value="<%= image %>" autocomplete="off">
                </div>
                <div class="form-group">
                    <label>Type:</label><br>
                    <select id="booktype" name="type" style="padding: 5px 30px; ">
                        <% var data=[ "นวนิยาย" , "การ์ตูน" , "วิชาการ" ]; for ( var i=0; i < data.length; i++ ) { var
                            selected=( data[0].book_type==i ) ? "selected" : "" ; %>
                            <option value="<%=i+1%>" <%=selected %>><%=data[i] %>
                            </option>
                            <% } %>
                    </select>
                </div>
                <br>
                <div class="form-group">
                    <a href="/books" class="btn btn-info">Back</a>
                    <input onclick="logdata()" type="submit" id="btn-button" class="btn btn-info" value="Add">
                </div>

            </form>
        </div>
    </div>


    <script>

        const addform = {
            name: document.getElementById('name'),
            details: document.getElementById('details'),
            price: document.getElementById('price'),
            quantity: document.getElementById('quantity'),
            image: document.querySelector('#upload_img').files[0],
            booktype: document.querySelector('#booktype'.value),
        };

        image.addEventListener("change", function () {
            var reader = new FileReader();
            reader.readAsDataURL(file);
            reader.onload = function () {
                localStorage.setItem("image", reader.result);
            };
        })


        function logdata() {
            // console.log(localStorage.getItem("image"));
            var price = document.getElementById('price').value;
            var quantity = document.getElementById('quantity').value;
            var price_pattern = /^[+]?\d+(\.\d{1,2})?$/;
            var quantity_pattern = /^[+]?[0-9]+$/;
            var price_result = price_pattern.test(price);
            var quantity_result = quantity_pattern.test(quantity);
            if (name.value == "" || details.value == "" || price.value == "" || quantity.value == "") {
                return Swal.fire({
                    icon: 'error',
                    title: 'Error...',
                    text: 'Please check your data!',
                });
            }
            if (!document.querySelector('#upload_img').files[0]){
                return Swal.fire({
                    icon: 'error',
                    title: 'Error...',
                    text: 'Please check your data!',
                });
            }
            if (price_result == false) {
                return Swal.fire({
                    icon: 'error',
                    title: 'Error...',
                    text: 'Please enter a valid price!',
                });
                // console.log("Please enter a valid price");
            }
            if (quantity_result == false) {
                return  Swal.fire({
                    icon: 'error',
                    title: 'Error...',
                    text: 'Please enter a valid quantity!',
                });
                // console.log("Please enter a valid quantity");
            }
            else {
                window.location = '/books/add';
                return Swal.fire({
                    title: 'Success!',
                    text: "Your product has been added!",
                    icon: 'success',
                    confirmButtonColor: '#6659ef',
                    confirmButtonText: 'OK'
                }).then((result) => {
                    if (result.isConfirmed) {
                        window.location = '/books';
                    }
                });
            }
        }



    </script>


</body>

</html>